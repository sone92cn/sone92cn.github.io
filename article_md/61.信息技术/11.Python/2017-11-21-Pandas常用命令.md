# Pandas常用命令

## 1、导入CSV
	(1)df = pd.read_csv("fname.csv", index_col=[], dtype={}, parse_dates=[], comment=None, encoding="utf8", nrows=10)
	(2)df = pd.read_csv("fname.csv", index_col=["id"], dtype={"order_id": "int64"}, parse_dates=["create_date", "create_time", "update_time"], comment=None, encoding="utf8")

## 2、查看基本信息
	df.shape
	df.dtypes
	df.discribe

## 3、转换数据类型
	df['col'] = df['col'].astype("float64")

## 4、数据筛选
	df[df.col1 > 0]
	df.query("id > 0")

## 5、数据排序
	df.sort_values(by, axis=0, ascending=True, inplace=False, kind='quicksort', na_position='last')

## 6、数据连接
### 6.1、横向连接
	(1)pd.merge(left, right, how='inner', on=None, left_on=None, right_on=None,left_index=False, right_index=False, sort=True, suffixes=('_x', '_y'), copy=True, indicator=False)
	(2)pd.concat(objs, axis=0, join='outer', join_axes=None, ignore_index=False, keys=None, levels=None, names=None, verify_integrity=False)
	(3)left.join(right, on=key_or_keys)
	--- pd.merge(left, right, left_on=key_or_keys, right_index=True,how='left', sort=False)
	
### 6.2、纵向连接
	df1.append(df2)
	df1.append([df2, df3], ignore_index=True)
	
## 7、删除重复数据
	tb.drop_duplicates(subset=['user_id'], keep=False)
	tb.drop_duplicates(subset=['user_id', "ad_id"], keep="first")
	tb.drop_duplicates(subset=['user_id', "ad_id"], keep="last")
	
## 8、获取唯一值
	tb["user_id"].unique()
	
## 9、分组运算
### 9.1、分组聚合
	tb.groupby("user_id").agg([np.max,np.sum])
	tb.groupby("user_id").agg({"id":[pd.Series.idxmax],"fee":[np.max,np.sum],"status":[pd.Series.count],"ad_id":[pd.Series.unique]})
	--- 首先尝试传递Series，失败再传输DataFrame>
	
### 9.2、分组变型
	tb[['user_id','ad_id']].groupby(['user_id']).transform(lambda x:np.arange(0, len(x)))
	--- 首先尝试传递Series，失败再传输DataFrame
	
### 9.3、分组过滤
	tb[['user_id','ad_id']].groupby(['user_id']).filter(lambda df:df['ad_id']>0)
	--- 传输DataFrame
### 9.4、自定义处理
	tb[['user_id','ad_id']].groupby(['user_id']).apply(lambda df:...)
	--- 传输DataFrame
	
## 10、修改Index
	df.setIndex("InxName",drop=True,append=False,inplace=False,verify_integrity=False) 设置单索引和复合索引
	df.reindex([IndexList]) 重新指定Index
	df.reset_index(level=None,drop=False,inplace=False,col_level=0,col_fill=”)还原索引，变为默认的整型索引 
	
## 11、DatetimeIndex转PeriodIndex
	df.to_period(freq="M", copy=True)  #要求index为datetimeIndex
	
## 12、普通DateTime转Period
	df["time_ym"].dt.year  #返回年份
	df["time_ym"].dt.month  #返回月份
	df["time_ym"].dt.to_period(freq="M")   #返回Period

## 13、计算出现的次序
	tb["ad_index"] = tb['ad_id'].groupby(tb['ad_id']).transform(lambda x:np.arange(0, len(x))) + 1
	tb["user_index"] = tb['user_id'].groupby(tb['user_id']).transform(lambda x:np.arange(0, len(x))) + 1
	
	tb["user_index"] = tb[['user_id','ad_id']].groupby(['user_id']).transform(lambda x:np.arange(0, len(x))) + 1
	tb["ad_index"] = tb[['user_id','ad_id']].groupby(['ad_id']).transform(lambda x:np.arange(0, len(x))) + 1
	
## 14、数据表透视
	tb.pivot(index=None, columns=None, values=None)  #数据透视，无法计算，要求透视后的Index不重复
	pd.pivot_table(data, values=None, index=None, columns=None, aggfunc='mean', fill_value=None, margins=False, dropna=True, margins_name='All')    #使用透视DataFrame,支持agg聚合参数， margins=True,透视后求和
	